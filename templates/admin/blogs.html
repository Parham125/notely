{% extends "base.html" %}
{% block title %}Blog Management - Admin - Notely{% endblock %}
{% block content %}
<div class="admin-header">
<h1>📝 Blog Management</h1>
<div class="admin-nav">
<a href="/admin" class="admin-nav-link">📊 Dashboard</a>
<a href="/admin/users" class="admin-nav-link">👥 Users</a>
<a href="/admin/blogs" class="admin-nav-link active">📝 Blogs</a>
<a href="/admin/comments" class="admin-nav-link">💬 Comments</a>
</div>
</div>

<div class="admin-info" style="margin-bottom:24px;">
<div class="info-card">
<div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;">
<div>
<h3 style="margin:0;color:var(--primary);font-size:18px;">📊 Blog Statistics</h3>
<p style="margin:8px 0 0 0;color:var(--text);"><strong>Total Blogs:</strong> {{total_blogs}} • Showing page {{current_page}} of {{total_pages}}</p>
</div>
<div>
<a href="/blog/new" class="btn btn-success" style="text-decoration:none;display:inline-flex;align-items:center;gap:8px;">
➕ New Blog
</a>
</div>
</div>
</div>
</div>

<div class="admin-controls" style="margin-bottom:24px;">
<div class="info-card" style="padding:16px;">
<form method="GET" class="search-form" style="background:transparent;border:none;padding:0;">
<div class="search-form-container" style="display:flex;align-items:center;width:100%;">
<span style="color:var(--text-secondary);font-weight:500;margin-right:12px;">🔍</span>
<input type="text" name="search" value="{{search}}" placeholder="Search blogs by title or author..." class="search-input" style="min-width:300px;flex:1;">
<div style="display:flex;gap:8px;margin-left:12px;">
<button type="submit" class="btn">Search</button>
{% if search %}
<a href="/admin/blogs" class="btn btn-secondary">Clear</a>
{% endif %}
</div>
</div>
</form>
</div>
</div>
{% if blogs %}
<div class="admin-table-container">
<table class="admin-table">
<thead>
<tr>
<th><a href="/admin/blogs?sort=title&order={{'asc' if sort == 'title' and order == 'desc' else 'desc'}}{{'&search=' + search if search else ''}}" style="color:var(--text);text-decoration:none;">Title {{'↓' if sort == 'title' and order == 'desc' else '↑' if sort == 'title' and order == 'asc' else ''}}</a></th>
<th><a href="/admin/blogs?sort=username&order={{'asc' if sort == 'username' and order == 'desc' else 'desc'}}{{'&search=' + search if search else ''}}" style="color:var(--text);text-decoration:none;">Author {{'↓' if sort == 'username' and order == 'desc' else '↑' if sort == 'username' and order == 'asc' else ''}}</a></th>
<th>Status</th>
<th><a href="/admin/blogs?sort=created_at&order={{'asc' if sort == 'created_at' and order == 'desc' else 'desc'}}{{'&search=' + search if search else ''}}" style="color:var(--text);text-decoration:none;">Created {{'↓' if sort == 'created_at' and order == 'desc' else '↑' if sort == 'created_at' and order == 'asc' else ''}}</a></th>
<th><a href="/admin/blogs?sort=updated_at&order={{'asc' if sort == 'updated_at' and order == 'desc' else 'desc'}}{{'&search=' + search if search else ''}}" style="color:var(--text);text-decoration:none;">Updated {{'↓' if sort == 'updated_at' and order == 'desc' else '↑' if sort == 'updated_at' and order == 'asc' else ''}}</a></th>
<th>Actions</th>
</tr>
</thead>
<tbody>
{% for blog in blogs %}
<tr>
<td style="max-width:300px;">
<a href="/blog/{{blog.id}}" target="_blank" class="blog-link">{{blog.title}}</a>
</td>
<td>
<img src="{{blog|avatar}}" alt="{{blog.display_name}}" class="profile-picture" style="width:30px;height:30px;vertical-align:middle;margin-right:8px;">
{{blog.display_name}} (@{{blog.username}})
</td>
<td>
{% if blog.is_draft %}
<span class="status-badge status-draft">Draft</span>
{% else %}
<span class="status-badge status-published">Published</span>
{% endif %}
</td>
<td>{{blog.created_at|timestampformat}}</td>
<td>{{blog.updated_at|timestampformat}}</td>
<td>
<div class="action-buttons">
<button onclick="deleteBlog('{{blog.id}}', '{{blog.title}}')" class="btn btn-small btn-danger">Delete</button>
</div>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
<div class="pagination" style="text-align:center;margin-top:30px;">
{% if current_page>1 %}
<a href="/admin/blogs?page={{current_page-1}}{{'&search=' + search if search else ''}}{{'&sort=' + sort if sort else ''}}{{'&order=' + order if order else ''}}" class="btn btn-secondary btn-small">← Previous</a>
{% endif %}
<span style="color:var(--text-secondary);margin:0 10px;">Page {{current_page}} of {{total_pages}}</span>
{% if current_page<total_pages %}
<a href="/admin/blogs?page={{current_page+1}}{{'&search=' + search if search else ''}}{{'&sort=' + sort if sort else ''}}{{'&order=' + order if order else ''}}" class="btn btn-secondary btn-small">Next →</a>
{% endif %}
</div>
{% else %}
<div class="admin-empty">
{% if search %}
<p>No blogs found matching "{{search}}".</p>
{% else %}
<p>No blogs found.</p>
{% endif %}
</div>
{% endif %}

<div id="message-container" style="position:fixed;top:20px;right:20px;z-index:1000;"></div>
{% endblock %}